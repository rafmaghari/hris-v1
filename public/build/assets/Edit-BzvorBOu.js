import{r as n,j as e,S as D,m as ge,L as be,$ as Ne}from"./app-DjJX563G.js";import{H as ve}from"./heading-DTdv5ui1.js";import{B as h}from"./createLucideIcon-D933E3G3.js";import{B as F}from"./badge-CwxXVCIS.js";import{C as te,a as ie,b as ce,c as le}from"./card-BxlICFpE.js";import{C as T}from"./checkbox-SLDZIGJF.js";import{D as B,a as V,b as M,c as q,d as G,e as K}from"./dialog-CLP12mSy.js";import{S as Se}from"./separator-U0aPbju_.js";import{u as J}from"./use-toast-D_yppkvP.js";import{S as L}from"./scroll-area-Br0mcb7x.js";import{S as W,a as X,b as Y,c as Z,e as ee,f as se,d as re}from"./select-DNVnAs1k.js";import{T as ye,a as Ce,b as ae,c as $,d as Ae,e as U}from"./table--ykkC-tS.js";import{P as ke,S as ne,T as Ee}from"./trash-plFYQvXB.js";import{U as Pe}from"./UserForm-7ItR963z.js";import{A as De}from"./app-layout-BttruBWi.js";/* empty css            */import"./index-DRLhT9hV.js";import"./index-BNfy59Gj.js";import"./input-gwDjpgU_.js";const z=c=>{D.visit(route("users.edit",{user:c}),{preserveScroll:!0,onSuccess:()=>{}})};function we({userId:c,platforms:C,companies:A,roles:p,permissions:u,userRolesByPlatformCompany:v={},userPermissionsByPlatformCompany:k={}}){const[d,f]=n.useState([]),[g,x]=n.useState(!1),[b,j]=n.useState(!1),[o,S]=n.useState(null),[m,E]=n.useState(""),[t,i]=n.useState(""),[l,P]=n.useState([]),[w,R]=n.useState([]),[I,O]=n.useState(!1),[H,_]=n.useState(!1),y=J(),de=(r,s)=>`${r}-${s}`;n.useEffect(()=>{const r=[];Object.keys(v).forEach(s=>{const[a,N]=s.split("-");r.push({platformId:a,companyId:N,roles:(v[s]||[]).map(Number),permissions:(k[s]||[]).map(Number),key:s})}),f(r)},[v,k]),n.useEffect(()=>{g&&(E(""),i(""),P([]),R([]))},[g]),n.useEffect(()=>{if(b&&o!==null){const r=d[o];E(r.platformId),i(r.companyId),P([...r.roles]),R([...r.permissions])}},[b,o,d]);const oe=async()=>{if(!m||!t){y.error("Please select both a platform and a company");return}const r=de(m,t);if(d.some(a=>a.key===r)){y.error("This platform-company combination already exists");return}const s={platformId:m,companyId:t,roles:l,permissions:w,key:r};_(!0),D.post(route("users.platform-company.access",{user:c,platform:m,company:t}),{role_ids:l,permission_ids:w},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{x(!1),f(a=>[...a,s]),y.success("Access added successfully"),_(!1),z(c)},onError:a=>{y.error("Failed to save access"),_(!1)},onFinish:()=>{document.visibilityState==="hidden"&&_(!1)}})},me=()=>{if(o===null)return;const r=d[o];O(!0),D.post(route("users.platform-company.access",{user:c,platform:r.platformId,company:r.companyId}),{role_ids:l,permission_ids:w},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{j(!1),S(null);const s=[...d];s[o]={...s[o],roles:l,permissions:w},f(s),y.success("Access updated successfully"),z(c),O(!1)},onError:s=>{y.error("Failed to update access"),O(!1)}})},xe=r=>{S(r),j(!0)},he=r=>{const s=d[r];D.post(route("users.platform-company.access",{user:c,platform:s.platformId,company:s.companyId}),{role_ids:[],permission_ids:[]},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{const a=[...d];a.splice(r,1),f(a),y.success("Access removed successfully"),z(c)},onError:a=>{y.error("Failed to remove access")}})},pe=(r,s)=>{P(a=>s?[...a,r]:a.filter(N=>N!==r))},ue=(r,s)=>{R(a=>s?[...a,r]:a.filter(N=>N!==r))},je=r=>{const s=C.find(a=>a.id.toString()===r);return s?s.name:"Unknown Platform"},fe=r=>{const s=A.find(a=>a.id.toString()===r);return s?s.name:"Unknown Company"},Q=r=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Platform"}),e.jsxs(W,{value:m,onValueChange:E,disabled:r,children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Select a platform"})}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(se,{children:"Platforms"}),C.map(s=>e.jsx(re,{value:s.id.toString(),children:s.name},s.id))]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Company"}),e.jsxs(W,{value:t,onValueChange:i,disabled:!m||r,children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Select a company"})}),e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsx(se,{children:"Companies"}),A.map(s=>e.jsx(re,{value:s.id.toString(),children:s.name},s.id))]})})]})]})]}),m&&t&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"my-4"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Roles"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(L,{className:"h-36",children:e.jsx("div",{className:"space-y-2 p-2",children:p.map(s=>{const a=Number(s.id);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:`role-${a}`,checked:l.includes(a),onCheckedChange:N=>pe(a,N)}),e.jsx("label",{htmlFor:`role-${a}`,className:"cursor-pointer text-sm",children:s.name})]},a)})})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Permissions"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(L,{className:"h-36",children:e.jsx("div",{className:"space-y-2 p-2",children:u.map(s=>{const a=Number(s.id);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:`permission-${a}`,checked:w.includes(a),onCheckedChange:N=>ue(a,N)}),e.jsx("label",{htmlFor:`permission-${a}`,className:"cursor-pointer text-sm",children:s.name})]},a)})})})})]})]})]})]});return e.jsxs(te,{children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{children:"Platform & Company Access"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(h,{size:"sm",onClick:()=>x(!0),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Add Access"]})})]})}),e.jsxs(le,{children:[d.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500",children:'No platform-company access found. Click "Add Access" to assign access.'}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-6 rounded-md border",children:e.jsxs(ye,{children:[e.jsx(Ce,{children:e.jsxs(ae,{children:[e.jsx($,{children:"Platform"}),e.jsx($,{children:"Company"}),e.jsx($,{children:"Roles"}),e.jsx($,{children:"Permissions"}),e.jsx($,{className:"text-right",children:"Actions"})]})}),e.jsx(Ae,{children:d.map((r,s)=>e.jsxs(ae,{children:[e.jsx(U,{className:"font-medium",children:je(r.platformId)}),e.jsx(U,{children:fe(r.companyId)}),e.jsx(U,{children:e.jsx(F,{className:"bg-blue-100 text-blue-800 hover:bg-blue-200",children:r.roles.length})}),e.jsx(U,{children:e.jsx(F,{className:"bg-purple-100 text-purple-800 hover:bg-purple-200",children:r.permissions.length})}),e.jsx(U,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>xe(s),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>he(s),children:e.jsx(Ee,{className:"h-4 w-4"})})]})})]},r.key))})]})})}),e.jsx(B,{open:g,onOpenChange:x,children:e.jsxs(V,{className:"sm:max-w-[625px]",children:[e.jsxs(M,{children:[e.jsx(q,{children:"Add Platform-Company Access"}),e.jsx(G,{children:"Assign roles and permissions for a platform-company combination."})]}),Q(!1),e.jsxs(K,{children:[e.jsx(h,{variant:"outline",onClick:()=>x(!1),disabled:H,children:"Cancel"}),e.jsx(h,{onClick:oe,disabled:!m||!t||H,children:H?"Saving...":"Add Access"})]})]})}),e.jsx(B,{open:b,onOpenChange:j,children:e.jsxs(V,{className:"sm:max-w-[625px]",children:[e.jsxs(M,{children:[e.jsx(q,{children:"Edit Access"}),e.jsx(G,{children:"Modify roles and permissions for this platform-company combination."})]}),Q(!0),e.jsxs(K,{children:[e.jsx(h,{variant:"outline",onClick:()=>{j(!1),S(null)},disabled:I,children:"Cancel"}),e.jsx(h,{onClick:me,disabled:I,children:I?"Updating...":"Update Access"})]})]})})]})]})}function $e({userId:c,roles:C,permissions:A,userRoles:p=[],userPermissions:u=[]}){const[v,k]=n.useState([]),[d,f]=n.useState([]),[g,x]=n.useState(!1),[b,j]=n.useState(!1),o=J();n.useEffect(()=>{k(p.map(Number)),f(u.map(Number))},[p,u]);const S=(t,i)=>{k(l=>i?[...l,t]:l.filter(P=>P!==t))},m=(t,i)=>{f(l=>i?[...l,t]:l.filter(P=>P!==t))},E=()=>{j(!0),D.post(route("users.direct-access",{user:c}),{role_ids:v,permission_ids:d},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{x(!1),o.success("User roles and permissions updated successfully"),j(!1),D.visit(route("users.edit",{user:c}),{preserveScroll:!0})},onError:t=>{o.error("Failed to update user roles and permissions"),j(!1)}})};return e.jsxs(te,{children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{children:"Direct User Roles & Permissions"}),e.jsxs(h,{size:"sm",onClick:()=>x(!0),children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Edit Access"]})]})}),e.jsxs(le,{children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Assigned Roles"}),e.jsx(F,{className:"bg-blue-100 text-blue-800",children:p.length})]}),p.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No roles assigned"}):e.jsx("div",{className:"space-y-1",children:p.map(t=>{const i=C.find(l=>l.id===t);return e.jsx("div",{className:"text-sm",children:(i==null?void 0:i.name)||`Role ${t}`},t)})})]}),e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Assigned Permissions"}),e.jsx(F,{className:"bg-purple-100 text-purple-800",children:u.length})]}),u.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No permissions assigned"}):e.jsx("div",{className:"space-y-1",children:u.map(t=>{const i=A.find(l=>l.id===t);return e.jsx("div",{className:"text-sm",children:(i==null?void 0:i.name)||`Permission ${t}`},t)})})]})]}),e.jsx(B,{open:g,onOpenChange:x,children:e.jsxs(V,{className:"sm:max-w-[625px]",children:[e.jsxs(M,{children:[e.jsx(q,{children:"Edit User Roles & Permissions"}),e.jsx(G,{children:"Assign direct roles and permissions to this user."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Roles"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(L,{className:"h-60",children:e.jsx("div",{className:"space-y-2 p-2",children:C.map(t=>{const i=Number(t.id);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:`role-${i}`,checked:v.includes(i),onCheckedChange:l=>S(i,l)}),e.jsx("label",{htmlFor:`role-${i}`,className:"cursor-pointer text-sm",children:t.name})]},i)})})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Permissions"}),e.jsx("div",{className:"rounded-md border",children:e.jsx(L,{className:"h-60",children:e.jsx("div",{className:"space-y-2 p-2",children:A.map(t=>{const i=Number(t.id);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:`permission-${i}`,checked:d.includes(i),onCheckedChange:l=>m(i,l)}),e.jsx("label",{htmlFor:`permission-${i}`,className:"cursor-pointer text-sm",children:t.name})]},i)})})})})]})]}),e.jsxs(K,{children:[e.jsx(h,{variant:"outline",onClick:()=>x(!1),disabled:b,children:"Cancel"}),e.jsx(h,{onClick:E,disabled:b,children:b?"Updating...":"Update Access"})]})]})})]})]})}const Ue=[{title:"Dashboard",href:route("dashboard")},{title:"Users",href:route("users.index")},{title:"Edit",href:"#"}];function Ye({user:c,platforms:C,companies:A,roles:p,permissions:u,userRolesByPlatformCompany:v,userPermissionsByPlatformCompany:k,userDirectRoles:d=[],userDirectPermissions:f=[]}){const{data:g,setData:x,put:b,processing:j,errors:o}=ge({first_name:c.first_name||"",last_name:c.last_name||"",email:c.email||"",password:"",password_confirmation:""}),S=J();function m(E){E.preventDefault(),b(route("users.update",{user:c.id}),{onSuccess:()=>{S.itemUpdated(`${g.first_name} ${g.last_name}`,"User")},onError:()=>{S.error("Failed to update user. Please try again.")}})}return e.jsxs(De,{breadcrumbs:Ue,children:[e.jsx(be,{title:`Edit ${c.first_name} ${c.last_name}`}),e.jsxs("div",{className:"my-4 flex items-center justify-between px-6",children:[e.jsx(ve,{title:`Edit ${c.first_name} ${c.last_name}`,className:"mb-0"}),e.jsx(Ne,{href:route("users.index"),children:e.jsx(h,{variant:"outline",children:"Cancel"})})]}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("div",{children:e.jsx(Pe,{data:g,setData:x,errors:o,processing:j,submitButtonText:"Update User",onSubmit:m,isEditMode:!0})}),e.jsx($e,{userId:c.id,roles:p,permissions:u,userRoles:d,userPermissions:f}),e.jsx(we,{userId:c.id,platforms:C,companies:A,roles:p,permissions:u,userRolesByPlatformCompany:v,userPermissionsByPlatformCompany:k})]})]})}export{Ye as default};
