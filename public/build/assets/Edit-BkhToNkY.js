import{t as L,r as n,j as s,L as $,S}from"./app-DjJX563G.js";import{H as V}from"./heading-DTdv5ui1.js";import{c as Z,B as R}from"./createLucideIcon-D933E3G3.js";import{C as U,a as Y,b as q,c as z}from"./card-BxlICFpE.js";import{C as G}from"./confirmation-dialog-C-nCidfX.js";import{A as J}from"./app-layout-BttruBWi.js";import K from"./MenuFormDialog-D2GQrI_g.js";import Q from"./MenuTree-Bq6-3Oyf.js";import{P as W}from"./trash-plFYQvXB.js";/* empty css            */import"./dialog-CLP12mSy.js";import"./select-DNVnAs1k.js";import"./index-DRLhT9hV.js";import"./index-BNfy59Gj.js";import"./MenuForm-2m6IR9fv.js";import"./checkbox-SLDZIGJF.js";import"./input-gwDjpgU_.js";import"./label-C7UnHOxM.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],ee=Z("FolderTree",X);function a({title:i,description:f,action:m,variant:u}){return L(i,{description:f,action:m,className:u==="destructive"?"bg-destructive text-destructive-foreground":void 0})}const te=[{title:"Dashboard",href:route("dashboard")},{title:"Menu Builder",href:route("menu-builder.index")},{title:"Edit",href:"#"}];function be({platform:i,menuTree:f,permissions:m}){const[u,h]=n.useState(f),[A,o]=n.useState(!1),[p,M]=n.useState(!1),[x,g]=n.useState(null),[y,d]=n.useState(!1),[F,v]=n.useState(!1),[j,_]=n.useState(null);console.log("Permissions received:",m);const[T,b]=n.useState({name:"",slug:"",url:"",parent_id:null,is_active:!0,permissions:[]}),N=()=>{M(!1),g(null),b({name:"",slug:"",url:"",parent_id:null,is_active:!0,permissions:[]}),o(!0)},w=e=>{M(!1),g(null),b({name:"",slug:"",url:"",parent_id:e.id,is_active:!0,permissions:[]}),o(!0)},P=e=>{M(!0),g(e),console.log("Selected menu for edit:",e),console.log("Menu permissions:",e.permissions);const r=(l,I,H=null)=>{for(const c of I){if(c.id===l)return H;if(c.children&&c.children.length>0){const C=r(l,c.children,c.id);if(C!==null)return C}}return null},t=r(e.id,u);b({name:e.name,slug:e.slug||"",url:e.url||"",parent_id:t,is_active:e.is_active,permissions:e.permissions?e.permissions.map(l=>l.id):[]}),console.log("Form data permissions after mapping:",e.permissions?e.permissions.map(l=>l.id):[]),o(!0)},B=e=>{const r=E.find(t=>t.id===e);if(r&&r.children&&r.children.length>0){a({title:"Cannot Delete Menu",description:"This menu has sub-menus. Please delete all sub-menus first.",variant:"destructive"});return}_(e),v(!0)},O=()=>{j&&(d(!0),S.delete(route("platforms.menus.destroy",{platform:i.id,menu:j}),{preserveScroll:!0,onSuccess:e=>{a({title:"Menu deleted",description:"The menu has been deleted successfully."}),e.props.menuTree&&Array.isArray(e.props.menuTree)&&h(e.props.menuTree)},onError:e=>{a({title:"Error",description:"Failed to delete menu. Please try again.",variant:"destructive"}),console.error("Error deleting menu:",e)},onFinish:()=>{d(!1),v(!1)}}))},k=(e,r=!1)=>{d(!0),r&&x?S.put(route("platforms.menus.update",{platform:i.id,menu:x.id}),e,{preserveScroll:!0,onSuccess:t=>{a({title:"Menu updated",description:"The menu has been updated successfully."}),o(!1),t.props.menuTree&&Array.isArray(t.props.menuTree)&&h(t.props.menuTree)},onError:t=>{a({title:"Error",description:"Failed to update menu. Please try again.",variant:"destructive"}),console.error("Error updating menu:",t)},onFinish:()=>{d(!1)}}):S.post(route("platforms.menus.store",{platform:i.id}),e,{preserveScroll:!0,onSuccess:t=>{a({title:"Menu created",description:"The menu has been created successfully."}),o(!1),t.props.menuTree&&Array.isArray(t.props.menuTree)&&h(t.props.menuTree)},onError:t=>{a({title:"Error",description:"Failed to create menu. Please try again.",variant:"destructive"}),console.error("Error creating menu:",t)},onFinish:()=>{d(!1)}})},D=e=>e.reduce((r,t)=>(r.push(t),t.children&&t.children.length>0&&(r=[...r,...D(t.children)]),r),[]),E=D(u);return s.jsxs(J,{breadcrumbs:te,children:[s.jsx($,{title:`Menu Builder - ${i.name}`}),s.jsxs("div",{className:"my-4 flex items-center justify-between px-5",children:[s.jsx(V,{title:`Menu Builder: ${i.name}`,className:"mb-0"}),s.jsxs(R,{onClick:N,children:[s.jsx(W,{className:"mr-2 h-4 w-4"}),"Add Menu"]})]}),s.jsx("div",{className:"p-6",children:s.jsxs(U,{children:[s.jsx(Y,{children:s.jsxs(q,{className:"flex items-center",children:[s.jsx(ee,{className:"mr-2 h-5 w-5"}),"Menu Structure"]})}),s.jsx(z,{children:s.jsx(Q,{menus:u,onAddSubMenu:w,onEditMenu:P,onDeleteMenu:B,isSubmitting:y})})]})}),s.jsx(K,{isOpen:A,onOpenChange:o,isEdit:p,title:p?"Edit Menu":"Add New Menu",description:p?"Update this menu item.":T.parent_id?"Create a new sub menu item.":"Create a new menu item for this platform.",initialData:T,permissions:m,allMenus:E,selectedMenu:x,isSubmitting:y,onCancel:()=>o(!1),onSubmit:e=>k(e,p)}),s.jsx(G,{title:"Confirm Deletion",description:s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"Are you sure you want to delete this menu? This action cannot be undone."}),s.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:"Note: Menus with sub-menus cannot be deleted. You must delete all sub-menus first."})]}),open:F,onOpenChange:v,onConfirm:O,confirmButtonText:"Delete",confirmButtonVariant:"destructive"})]})}export{be as default};
