import{r as n,j as r,L,S}from"./app-3Ds5Ugas.js";import{H as V}from"./heading-BmUx_2sw.js";import{c as Z,B as $}from"./createLucideIcon-D09f9KDG.js";import{C as R,a as U,b as Y,c as q}from"./card-N5NlBDpJ.js";import{C as z}from"./confirmation-dialog-C_y6r8OJ.js";import{t as o}from"./use-toast-FB-nhlMA.js";import{A as G}from"./app-layout-DT5DLS-H.js";import J from"./MenuFormDialog-B2zOHGl-.js";import{P as K,M as Q}from"./MenuTree-DC9oJKkM.js";/* empty css            */import"./dialog-pNzlA7wU.js";import"./index-DTU4xmPb.js";import"./index-C0-Rh8YQ.js";import"./admin-layout-KRPrd9IN.js";import"./applicationLogo-naLLS42X.js";import"./MenuForm-DOIQAuGm.js";import"./checkbox-BYy07ju-.js";import"./check-C9P8Vgop.js";import"./input-Dlgunh1D.js";import"./label-DEgNhSqZ.js";import"./select-CPBprour.js";import"./square-pen-DdqE-SlW.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],X=Z("FolderTree",W),ee=[{title:"Dashboard",href:route("dashboard")},{title:"Menu Builder",href:route("menu-builder.index")},{title:"Edit",href:"#"}];function je({platform:l,menuTree:C,permissions:b}){const[c,p]=n.useState(C),[A,i]=n.useState(!1),[m,f]=n.useState(!1),[h,M]=n.useState(null),[v,u]=n.useState(!1),[F,x]=n.useState(!1),[y,_]=n.useState(null);console.log("Permissions received:",b);const[j,g]=n.useState({name:"",slug:"",url:"",parent_id:null,is_active:!0,permissions:[]}),N=()=>{f(!1),M(null),g({name:"",slug:"",url:"",parent_id:null,is_active:!0,permissions:[]}),i(!0)},w=e=>{f(!1),M(null),g({name:"",slug:"",url:"",parent_id:e.id,is_active:!0,permissions:[]}),i(!0)},P=e=>{f(!0),M(e),console.log("Selected menu for edit:",e),console.log("Menu permissions:",e.permissions);const s=(a,I,H=null)=>{for(const d of I){if(d.id===a)return H;if(d.children&&d.children.length>0){const E=s(a,d.children,d.id);if(E!==null)return E}}return null},t=s(e.id,c);g({name:e.name,slug:e.slug||"",url:e.url||"",parent_id:t,is_active:e.is_active,permissions:e.permissions?e.permissions.map(a=>a.id):[]}),console.log("Form data permissions after mapping:",e.permissions?e.permissions.map(a=>a.id):[]),i(!0)},B=e=>{const s=D.find(t=>t.id===e);if(s&&s.children&&s.children.length>0){o({title:"Cannot Delete Menu",description:"This menu has sub-menus. Please delete all sub-menus first.",variant:"destructive"});return}_(e),x(!0)},O=()=>{y&&(u(!0),S.delete(route("platforms.menus.destroy",{platform:l.id,menu:y}),{preserveScroll:!0,onSuccess:e=>{o({title:"Menu deleted",description:"The menu has been deleted successfully."}),e.props.menuTree&&Array.isArray(e.props.menuTree)&&p(e.props.menuTree)},onError:e=>{o({title:"Error",description:"Failed to delete menu. Please try again.",variant:"destructive"}),console.error("Error deleting menu:",e)},onFinish:()=>{u(!1),x(!1)}}))},k=(e,s=!1)=>{u(!0),s&&h?S.put(route("platforms.menus.update",{platform:l.id,menu:h.id}),e,{preserveScroll:!0,onSuccess:t=>{o({title:"Menu updated",description:"The menu has been updated successfully."}),i(!1),t.props.menuTree&&Array.isArray(t.props.menuTree)&&p(t.props.menuTree)},onError:t=>{o({title:"Error",description:"Failed to update menu. Please try again.",variant:"destructive"}),console.error("Error updating menu:",t)},onFinish:()=>{u(!1)}}):S.post(route("platforms.menus.store",{platform:l.id}),e,{preserveScroll:!0,onSuccess:t=>{o({title:"Menu created",description:"The menu has been created successfully."}),i(!1),t.props.menuTree&&Array.isArray(t.props.menuTree)&&p(t.props.menuTree)},onError:t=>{o({title:"Error",description:"Failed to create menu. Please try again.",variant:"destructive"}),console.error("Error creating menu:",t)},onFinish:()=>{u(!1)}})},T=e=>e.reduce((s,t)=>(s.push(t),t.children&&t.children.length>0&&(s=[...s,...T(t.children)]),s),[]),D=T(c);return r.jsxs(G,{breadcrumbs:ee,children:[r.jsx(L,{title:`Menu Builder - ${l.name}`}),r.jsxs("div",{className:"my-4 flex items-center justify-between px-5",children:[r.jsx(V,{title:`Menu Builder: ${l.name}`,className:"mb-0"}),r.jsxs($,{onClick:N,children:[r.jsx(K,{className:"mr-2 h-4 w-4"}),"Add Menu"]})]}),r.jsx("div",{className:"p-6",children:r.jsxs(R,{children:[r.jsx(U,{children:r.jsxs(Y,{className:"flex items-center",children:[r.jsx(X,{className:"mr-2 h-5 w-5"}),"Menu Structure"]})}),r.jsx(q,{children:r.jsx(Q,{menus:c,onAddSubMenu:w,onEditMenu:P,onDeleteMenu:B,isSubmitting:v})})]})}),r.jsx(J,{isOpen:A,onOpenChange:i,isEdit:m,title:m?"Edit Menu":"Add New Menu",description:m?"Update this menu item.":j.parent_id?"Create a new sub menu item.":"Create a new menu item for this platform.",initialData:j,permissions:b,allMenus:D,selectedMenu:h,isSubmitting:v,onCancel:()=>i(!1),onSubmit:e=>k(e,m)}),r.jsx(z,{title:"Confirm Deletion",description:r.jsxs(r.Fragment,{children:[r.jsx("p",{children:"Are you sure you want to delete this menu? This action cannot be undone."}),r.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:"Note: Menus with sub-menus cannot be deleted. You must delete all sub-menus first."})]}),open:F,onOpenChange:x,onConfirm:O,confirmButtonText:"Delete",confirmButtonVariant:"destructive"})]})}export{je as default};
